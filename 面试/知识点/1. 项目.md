### 1.1 实习简历

在线商城是看开源项目还是自己从头撸的？（今日头条一面，淘宝一面，深信服二面，腾讯云二面）

这个项目能很好地扩容到分布式嘛？（淘宝一面）

在线商城项目的架构设计（快手二面）

项目中是否应到哪些HTTP请求方法（华为Cloudbu一面）

在线商城系统是否应用到响应码（华为Cloudbu一面）

用户从搜索到下单的业务流程（腾讯TEG一面）

> 用户进行搜索，先利用ES进行一个倒排索引的查询，查询到指定商品后，进行下单，后端检测到该商品被锁定后，利用Redis进行上锁。用户下单后，数据库中对应商品数减1。

取消超时订单操作是怎么做的？（腾讯CDG一面，淘宝一面）

> - 用户下单后，生成订单id；
> - 获取到设置的订单超时时间（假设设置的为60分钟不支付取消订单）；
> - 按订单超时时间发送一个延迟消息给Kafka，让它在订单超时后触发取消订单的操作；
> - 如果没有支付，进行取消订单

为什么使用RabbitMQ，而不是采用其它消息队列？（深信服二面）

> RabbitMQ和Kafka的区别：
> 
> - 通常会使用Kafka作为消息传输的数据管道，RabbitMQ作为交易数据作为数据传输管道，主要的取舍因素则是存在丢数据的可能
> - RabbitMQ在金融场景下经常使用，具有较高的严谨性，数据丢失的可能性更小，同时具备更高的实时性
> - Kafka优势主要体现在吞吐量上，虽然可以通过策略实现数据不丢失，但从严谨性角度来讲，大不如RabbitMQ
> - 而且由于Kafka保证每条数据最少送达一次，有较小的概率会出现数据重复发送的情况

提交超时订单为什么要用消息队列？而不用Redis的超时清理？（深信服一面）

用户登录与授权是怎么实现安全性的？（今日头条一面，深信服二面）

> 主要使用JWT实现用户登录与授权的安全性。
> 
> - 用户调用登录接口，登录成功后获取到JWT的token；
> - 之后用户每次调用接口都在http的header中添加一个叫Authorization的头，值为JWT的token；
> - 后台程序通过对Authorization头中的信息解码及数字签名验证来获取其中的用户信息，从而实现登录和授权

怎么处理JWT中的token过期的事情？（今日头条一面）

> [JWT生成token及过期处理方案](https://my.oschina.net/odetteisgorgeous/blog/1920762)
> 
> - 基本思路
>   
>   - token(A)过期设置为15分钟
>   - 前端发起请求，后端验证token(A)是否过期
>     - 如果过期，前端发起刷新token请求，后端设置已在此标记为true，请求成功
>   - 前端发起请求，后端验证再次授权标记
>     - 如果已经再次授权，则拒绝token的请求，请求成功
>   - 如果前端每隔72小时，必须重新登陆，后端检查用户最后依次登录日期
>     - 如超过72小时，则拒绝刷新token的请求，请求失败
> 
> - 后端
>   
>   - 在登陆接口中 如果校验账号密码成功 则根据用户id和用户类型创建jwt token(有效期设置为-1，即永不过期) 得到A
>   
>   - 更新登录日期(当前时间new Date()即可)，得到B
>   
>   - \redis中缓存key为`ACCESS_TOKEN:userId:A`(加上A是为了防止用户多个客户端登录 造成token覆盖),value为B的毫秒数（转换成字符串类型），过期时间为7天（7 * 24 * 60 * 60）
>   
>   - 在登录结果中返回json格式为`{"result":"success","token": A}`
>   
>   - 用户在接口请求header中携带token进行登录，后端在所有接口前置拦截器进行拦截，作用是解析token 拿到userId和用户类型（用户调用业务接口只需要传token即可）
>     
>     - 如果解析失败（抛出SignatureException），则返回json（code = 0 ,info= Token验证不通过, errorCode = '1001'）；
>   
>   - 此外如果解析成功，验证redis中key为`ACCESS_TOKEN:userId:A` 是否存在
>     
>     - 如果不存在 则返回json（code = 0 ,info= 会话过期请重新登录, errorCode = '1002'）；
>     - 如果缓存key存在，则自动续7天超时时间（value不变），实现频繁登录用户免登陆。
>   
>   - 把userId和用户类型放入request参数中 接口方法中可以直接拿到登录用户信息
>   
>   - 如果是修改密码或退出登录 则废除access_tokens（删除key）
> 
> - 前端(VUE)
>   
>   - 用户登录成功，则把username存入cookie中，key为loginUser;把token存入cookie中，key为accessToken 把token存入Vuex全局状态中
>   - 进入首页

地震监控后台优化

> - 缓存优化
>   
>   - 优化原因
>     - 在原先用户登录时，或者切换其他站点查看地震监控数据时，都会从亚马逊云端读取粗糙数据并在后台进行计算后返回给前端，造成了时间复杂度的大幅度增加。
>   - 改进
>     - 增加了缓存优化，在服务器端维护了一个缓存区，将初次登录的计算的结果进行缓存，从而避免在切换站点时进行反复时的重复计算。在退出登录时，这个缓冲区会被删除。
> 
> - 异步优化
>   
>   - 优化原因
>     - 同样是在后台进行计算时返回前端时，事实上，计算的部分中间结果就可以返回给前端，但是却加上需要计算最终结果并与亚马逊云端进行通过
>   - 改进
>     - 使用线程池ThreadPoolExecutor 增加异步操作，先将中间结果返回给前端，并较给线程在后台执行耗时任务。

Redis数据缓存和分布式锁做的是什么？（快手一面，淘宝一面，腾讯云二面）

> 手机验证码功能。根据手机号生成随机的验证码并设置过期时间，存储在Redis中。使用到了String数据结构。
> 
> Redis分布式锁主要利用Redis的setnx命令。
> 
> - 加锁命令：`SETNX key value`，当键不存在时，对键进行设置操作并返回成功，否则返回失败。
>   - `key`是锁的唯一标识，一般按业务来决定命名，`value`可以使用`uuid`来保证唯一；
> - 解锁命令：`DEL key`，通过删除键值对释放锁，以便其他线程可以通过SETNX命令来获取锁；
> - 锁超时：`EXPIRE key timeout`，设置key的超时时间，以保证即使锁没有被显式释放，锁也可以在第一时间后自动释放，避免资源用于被锁住。

为什么会想到用到分布式锁？（快手一面，深信服一面，腾讯云二面）

> 如果在一个分布式系统中，我们从数据库中读取一个数据，然后修改保存，这种情况很容易遇到并发问题。因此读取和更新保存不是一个原子操作，在并发时就会导致数据的不正确性。比如电商秒杀活动，库存数量的更新就是遇到。如果单机应用，直接使用本地锁就可以避免。如果是分布式应用，本地锁派不上用场，这时就需要引入分布式锁来解决。
> 
> 分布式锁的目的是为了保证多台服务器在执行某一段代码时保证只有一台服务器执行。

是一个商品一个锁吗？如何防止一个用户锁定了多个商品？（深信服一面）

> 是一个商品一个锁，因为Redis是单线程的且基于IO复用模型的，因此不会出现一个用户锁定多个商品的情况

锁是否真的实现商品被超购（腾讯云二面）

SETNX是原子操作吗？不是原子操作会出现什么问题（腾讯云二面）

> SETNX和EXPIRE是非原子性的
> 
> 如果SETNX成功，在设置锁超时时间后，服务器挂掉、重启或网络问题等，导致EXPIRE命令没有被执行，锁没有设置超时时间变成死锁
> 
> 解决方法：
> 
> ```lua
> if (redis.call('setnx', KEYS[1], ARGV[1]) < 1)
> then return 0;
> end;
> redis.call('expire', KEYS[1], tonumber(ARGV[2]));
> return 1;
> 
> // 使用实例
> EVAL "if (redis.call('setnx',KEYS[1],ARGV[1]) < 1) then return 0; end; redis.call('expire',KEYS[1],tonumber(ARGV[2])); return 1;" 1 key value 100
> ```

### 1.2 秋招简历

链路追踪的调研（字节系统研发一面）

追踪的原理（字节系统研发一面）

> 基本概念
> 
> - Trace就表示一个完整的调用链
> 
> - span表示一个RPC调用
> 
> - 使用grpc发送数据至落库（ES）
> 
> Java 使用字节码增强进行接入，在运行Java命令时指定agent的位置
> 
> [Dapper,大规模分布式系统的跟踪系统](https://cloud.tencent.com/developer/article/1031932)

链路追踪的作用，技术选型的依据（百度一面）

为什么选consul作为微服务注册中心（百度一面）

consul如何进行服务发现、注册中心、熔断、限流（百度一面）

> Consul 官网中介绍了 Consul 的以下几个核心功能：
> 
> - **服务发现(Service Discovery)**：提供 HTTP 与 DNS 两种方式。
> - **健康检查(Health Checking)**：提供多种健康检查方式，比如 HTTP 状态码、内存使用情况、硬盘等等。
> - **键值存储(KV Store)**：可以作为服务配置中心使用，类似 Spring Cloud Config。
> - **加密服务通信(Secure Service Communication)**
> - **多数据中心(Multi Datacenter)**：Consul 通过 WAN 的 Gossip 协议，完成跨数据中心的同步。
> 
> 负载均衡由客户端实现，从注册中心拿到要访问的服务的ip列表后，使用轮询
> 
> 降级是指突发流量来了，保住核心服务，非核心就不接流量了
> 
> 熔断是下游挂了，不访问下游返回默认

### 1.3 场景题

一亿个视频，一亿个用户，统计每个视频被多少个用户播放（腾讯云一面）

一个仓库，需要出货，每个货物具有不同的优先级，设计一个程序来优先出货优先级比较高的货物。相同优先级的货品如何排列（腾讯云二面）

说一下手机播放视频失败的原因（今日头条测开二面）

大文件的查询，想做一个关键词查询（今日头条测开二面）

数据存在MySQL数据库中，这些数据是否是明文的？如果一些框架出现安全问题，要怎样保证数据库中的数据的安全？（深信服二面）

Redis如果整个集群都掉电挂了，且没有持久化，怎么办（腾讯TEG一面）

在数据结构中，一个亿的无序数据如何快速取前面100个（腾讯TEG一面）
