### 4.1 基础

线程和进程的区别？(今日头条一面，==字节系统研发一面==)

> - 拥有资源。进程是资源分配的基本单位，但是线程不拥有资源，线程可以访问所属进程的资源。
> - 调度。线程是独立调度的基本单位，在同一进程中线程之间的上下文切换不会带来进程之间的上下文切换
> - 系统开销。线程之间的上下文切换的开销远小于进程
> - 通信方面。同一进程的线程通过读取数据进行通信，但是进程通信需要借助 IPC
> 
> 进程切换的过程：
> 
> 1. 保存处理机上下文，包括程序计数器和其他寄存器。
> 2. 更新PCB信息。
> 3. 把进程的PCB移入相应的队列，如就绪、在某事件阻塞等队列。
> 4. 选择另一个进程执行，并更新其PCB。
> 5. 更新内存管理的数据结构。
> 6. 恢复处理机上下文。

线程和进程拥有哪些资源（==字节系统研发一面==）

> ![img](https://oscimg.oschina.net/oscnet/up-cd8ac705f6f004c01e0a1312f1599430ba5.png)

线程之间的同步机制（==字节系统研发一面==，==华为公共开发一面==）

> 1. **互斥量(Mutex)**：采用互斥对象机制，只有拥有互斥对象的线程才有访问公共资源的权限。因为互斥对象只有一个，所以可以保证公共资源不会被多个线程同时访问。比如 Java 中的 synchronized 关键词和各种 Lock 都是这种机制。
> 2. **信号量(Semphares)** ：它允许同一时刻多个线程访问同一资源，但是需要控制同一时刻访问此资源的最大线程数量
> 3. **事件(Event)** :Wait/Notify：通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操作

多个进程之间通讯的方式？管道具体指的是什么？什么场景下会用到管道？(今日头条一面，腾讯CDG一面，今日头条测开二面)

> - **管道/匿名管道(Pipes)**
>   - 用于具有亲缘关系的父子进程间或者兄弟进程之间的通信。
> - **有名管道(Names Pipes)** :
>   - 匿名管道由于没有名字，只能用于亲缘关系的进程间通信。为了克服这个缺点，提出了有名管道。
>   - 有名管道严格遵循**先进先出(first in first out)**。有名管道以磁盘文件的方式存在，可以实现本机任意两个进程通信。
> - **信号(Signal)**
>   - 信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生；
> - **消息队列(Message Queuing)**
>   - 消息队列是消息的链表,具有特定的格式,存放在内存中并由消息队列标识符标识。
>   - 管道和消息队列的通信数据都是先进先出的原则。
>   - 与管道（无名管道：只存在于内存中的文件；命名管道：存在于实际的磁盘介质或者文件系统）不同的是消息队列存放在内核中，只有在内核重启(即，操作系统重启)或者显示地删除一个消息队列时，该消息队列才会被真正的删除。
>   - 消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,也可以按消息的类型读取.比 FIFO 更有优势。
>   - **消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺点。**
> - **信号量(Semaphores)**
>   - 信号量是一个计数器，用于多进程对共享数据的访问，信号量的意图在于进程间同步。
>   - 这种通信方式主要用于解决与同步相关的问题并避免竞争条件。
> - **共享内存(Shared memory)**
>   - 使得多个进程可以访问同一块内存空间，不同进程可以及时看到对方进程中对共享内存中数据的更新
>   - 这种方式需要依靠某种同步操作，如互斥锁和信号量等。可以说这是最有用的进程间通信方式。
> - **套接字(Sockets)** :
>   - 此方法主要用于在客户端和服务器之间通过网络进行通信。
>   - 套接字是支持 TCP/IP 的网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点，简单的说就是通信的两方的一种约定，用套接字中的相关函数来完成通信过程。

进程切换操作系统会做什么（腾讯云一面）

操作系统的调度算法（腾讯云一面）

> - **先到先服务(FCFS)调度算法** : 从就绪队列中选择一个最先进入该队列的进程为之分配资源，使它立即执行并一直执行到完成或发生某事件而被阻塞放弃占用 CPU 时再重新调度。
> - **短作业优先(SJF)的调度算法** : 从就绪队列中选出一个估计运行时间最短的进程为之分配资源，使它立即执行并一直执行到完成或发生某事件而被阻塞放弃占用 CPU 时再重新调度。
> - **时间片轮转调度算法** : 时间片轮转调度是一种最古老，最简单，最公平且使用最广的算法，又称 RR(Round robin)调度。每个进程被分配一个时间段，称作它的时间片，即该进程允许运行的时间。
> - **多级反馈队列调度算法** ：前面介绍的几种进程调度的算法都有一定的局限性。如**短进程优先的调度算法，仅照顾了短进程而忽略了长进程** 。多级反馈队列调度算法既能使高优先级的作业得到响应又能使短作业（进程）迅速完成。，因而它是目前**被公认的一种较好的进程调度算法**，UNIX 操作系统采取的便是这种调度算法。
> - **优先级调度** ： 为每个流程分配优先级，首先执行具有最高优先级的进程，依此类推。具有相同优先级的进程以 FCFS 方式执行。可以根据内存要求，时间要求或任何其他资源要求来确定优先级。

逻辑地址（虚拟地址)、物理地址、分段、分页（==字节系统研发一面==）

> 一、连续分配管理方式和非连续分配管理方式
> 
> - 连续分配管理方式是指为一个用户程序分配一个连续的内存空间，常见的如 **块式管理**；
> - 非连续分配管理方式允许一个程序使用的内存分布在离散或者说不相邻的内存中，常见的如**页式管理** 和 **段式管理**。
> 
> 二、常见的内存管理机制
> 
> - **块式管理** ： 远古时代的计算机操系统的内存管理方式。将内存分为几个固定大小的块，每个块中只包含一个进程。如果程序运行需要内存的话，操作系统就分配给它一块，如果程序运行只需要很小的空间的话，分配的这块内存很大一部分几乎被浪费了。这些在每个块中未被利用的空间，我们称之为碎片。
> - **页式管理** ：把主存分为大小相等且固定的一页一页的形式，页较小，相对相比于块式管理的划分力度更大，提高了内存利用率，减少了碎片。页式管理通过页表对应逻辑地址和物理地址。
> - **段式管理** ： 页式管理虽然提高了内存利用率，但是页式管理其中的页实际并无任何实际意义。 段式管理把主存分为一段段的，每一段的空间又要比一页的空间小很多 。但是，最重要的是段是有实际意义的，每个段定义了一组逻辑信息，例如,有主程序段 MAIN、子程序段 X、数据段 D 及栈段 S 等。 段式管理通过段表对应逻辑地址和物理地址。
> - **段页式管理机制** ：段页式管理机制结合了段式管理和页式管理的优点。简单来说段页式管理机制就是把主存先分成若干段，每个段又分成若干页，也就是说 **段页式管理机制** 中段与段之间以及段的内部的都是离散的。
> 
> 三、分段和分页的共同点和区别
> 
> 1、共同点：
> 
> - 分页机制和分段机制都是为了提高内存利用率，较少内存碎片。
> - 页和段都是离散存储的，所以两者都是离散分配内存的方式。但是，每个页和段中的内存是连续的。
> 
> 2、区别：
> 
> - 页的大小是固定的，由操作系统决定；而段的大小不固定，取决于我们当前运行的程序。
> - 分页仅仅是为了满足操作系统内存管理的需求，而段是逻辑信息的单位，在程序中可以体现为代码段，数据段，能够更好满足用户的需要。
> 
> 四、逻辑地址（虚拟地址)与物理地址
> 
> - C语言指针存储的地址就是一个逻辑地址，由操作系统决定；
> - 物理地址指的是真实物理内存中的地址，是内存地址寄存器的地址
> 
> 五、为什么要有虚拟地址空间
> 
> 没有虚拟地址空间的时候，**程序都是直接访问和操作的都是物理内存** 。但是这样有什么问题呢？
> 
> - 用户程序可以访问任意内存，寻址内存的每个字节，这样就很容易（有意或者无意）破坏操作系统，造成操作系统崩溃。
> - 想要同时运行多个程序特别困难，比如你想同时运行一个微信和一个 QQ 音乐都不行。为什么呢？举个简单的例子：微信在运行的时候给内存地址 1xxx 赋值后，QQ 音乐也同样给内存地址 1xxx 赋值，那么 QQ 音乐对内存的赋值就会覆盖微信之前所赋的值，这就造成了微信这个程序就会崩溃。
> 
> 通过虚拟地址访问内存有以下优势：
> 
> - 程序可以使用一系列相邻的虚拟地址来访问物理内存中不相邻的大内存缓冲区。
> - 程序可以使用一系列虚拟地址来访问大于可用物理内存的内存缓冲区。
> - 不同进程使用的虚拟地址彼此隔离。一个进程中的代码无法更改正在由另一进程或操作系统使用的物理内存。

内存的命名映射（==字节系统研发一面==）

操作系统如何申请一块内存（腾讯云一面）

> 检查当前内存空间是否具有足够的空间，如果有则进行申请，并将逻辑地址与物理地址的映射写入页表；
> 
> 若没有则触发缺页中断，使用缺页中断算法将当前内存中的页面进行移除，再进行申请

### 4.2 Linux

linux的目录都是什么含义（华为Cloudbu一面）

> 为了使不同的Linux发布版本的目录结构保持一致性，FHS规定了Linux的目录结构。最基础的三个目录如下：
> 
> - /（root，根目录）
> - /usr（unix software resource）：系统默认软件都会安装到这个目录
> - /var（variable）：存放系统或程序运行过程中的数据文件
> 
> ![](https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/linux-filesystem.png)

linux下软链接和硬链接的区别？(今日头条一面)

> - 实体链接（硬链接）
>   
>   - 在目录下创建一个条目，记录文件名与inode编号，这个inode就是源文件的inode；
>   - 删除任意一个条目，文件还是存在，只要引用数量不为0。
>   - 限制
>     - 不能跨越文件系统、不能对目录进行链接
> 
> - 符号链接（软链接）
>   
>   - 符号链接文件保存着源文件所在的绝对路径，在读取时会定位到源文件上，可以理解为Windows的快捷方式；
>   - 当源文件被删除了，链接文件就打不开了；
>   - 因为记录的是路径，所以可以为目录简历符号链接

linux系统加载程序并运行的过程？(今日头条一面)

> [程序的编译、链接、装载与运行](https://www.nosuchfield.com/2018/11/23/Program-compilation-linking-loading-and-running/)
> 
> ![img](https://www.nosuchfield.com/images/20181123/main.png)
> 
> - 编译
>   - 将程序员所写的高级语言代码转化为对应的目标文件的过程。一般来说高级语言的编译要经过预处理、编译和汇编这几个过程
>   - 预处理
>   - 编译
>     - 对预处理之后的文本进行词法分析、语法分析、语义分析并优化后生成响应的汇编文件
>   - 汇编
>     - 将汇编代码转化为机器指令，生成目标文件
>     - 目标文件的结构与可执行文件是一致的，它们之间只存在一些细微的差异
>     - 目标文件是无法被执行的，它还需要链接这一步操作，目标文件被链接之后才可以产生可执行文件
> - 目标文件的格式
>   - Linux下的目标文件的格式叫做ELF（Executable Linkable Format），ELF header保存如下的内容：
>     - ELF的magic number
>     - 文件机器字节长度
>     - ELF版本
>     - 操作系统平台
>     - 硬件平台
>     - 程序的入口地址
>     - 段表的位置和长度。可以从ELF文件中获取到段表（Section Header Table）
>     - 段的数量
> - （静态）链接
>   - 与动态链接的比较
>     - 动态链接对内存和磁盘的节省十分有限
>     - 不需要考虑动态链接库的不同的版本，静态链接的文件可以做到链接即可执行，减少了运维和部署上的复杂度
>     - 在有些新发明的语言（例如golang）中链接过程中已经开始开始使用静态链接
>   - 静态链接的过程
>     - 扫面所有的目标文件，获取它们的每个段的长度、位置和属性，并将每个目标文件中的符号表的符号定义和符号引用收集起来放在一个全局符号表中，建立起可执行文件到目标文件的段映射关系
>     - 读取目标文件中的段时间，并解析符号表信息，根据符号表信息进行重定位、调整代码中的地址等操作
> - 装载
> - 运行
>   - 操作系统在创建进程之后，jmp到这个进程的入口函数
>   - 入口函数对程序运行环境进行初始化，包括堆、I/O、线程、全局变量的构造等等
>   - 入口函数在完成初始化之后，调用main函数，开始执行程序的主体
>   - main函数执行完毕之后返回到入口函数，入口函数进行清理工作，最后通过系统调用结束进程

Linux上常用到的一些命令（华为Cloudbu一面，腾讯CDG一面，深信服一面）

> - ls。列出文件或者目录信息
> - cd。更换当前目录
> - mkdir。创建目录
> - rmdir。删除目录，目录必须为空。
> - cp。复制文件
> - rm。删除文件
> - mv。移动文件
> - cat。获取文件内容
> - ps。查看某个时间点的进程信息
> - top。实时显示进程信息
> - kill。杀死进程
> - chmod。用于控制用户对文件的权限
> - netstat。用于显示各种网络相关信息，如网络连接，路由表，接口状态（Interface Statistics），masquerade连接，多播成员（Multicast Memberships）等

chmod命令的用法，777是什么含义（华为Cloudbu一面，==腾讯CDG事务开发一面==）

> 全称change mode，用于控制用户对文件的权限的命令
> 
> linux的权限有：
> 
> - r：4，读
> - w：2， 写
> - x：1，执行
> 
> 777表示三种不同的对象,即文件所有人，文件所有组，和其他人。

如何查询进程和线程的ID？（淘宝一面，==腾讯CDG事务开发一面==）

> - 查看进程ID的方式
>   - ps
> - 查看线程ID的方式
>   - ps -T -p 。
>   - Top -H -p 。
>   - htop
